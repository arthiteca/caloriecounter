╔══════════════════════════════════════════════════════════════════════╗
║                     СХЕМА РАБОТЫ БОТА                                ║
╚══════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────┐
│                    ПОЛЬЗОВАТЕЛЬ ЗАХОДИТ В БОТА                      │
└─────────────────────────────────────────────────────────────────────┘
                                 │
                                 ▼
                        ┌────────────────┐
                        │   /start       │
                        └────────────────┘
                                 │
                    ┌────────────┴────────────┐
                    │                         │
            ┌───────▼────────┐      ┌────────▼────────┐
            │  Ключ ЕСТЬ     │      │  Ключа НЕТ     │
            └───────┬────────┘      └────────┬────────┘
                    │                         │
                    │                         ▼
                    │            "🔒 Активируйте ключ"
                    │            "Используйте /activate"
                    │                         │
                    │                         │
                    ▼                         ▼
        "👋 Приветствие"           ┌─────────────────┐
        "Отправь фото!"             │   /activate     │
                                    └─────────────────┘
                                              │
                                              ▼
                                    "Введите ключ..."
                                              │
                                              ▼
                                    [пользователь вводит]
                                              │
                        ┌─────────────────────┼─────────────────────┐
                        │                     │                     │
                ┌───────▼─────────┐  ┌────────▼────────┐  ┌────────▼────────┐
                │ Ключ правильный │  │ Ключ занят      │  │ Ключ неверный  │
                └───────┬─────────┘  └────────┬────────┘  └────────┬────────┘
                        │                     │                     │
                        ▼                     ▼                     ▼
              "✅ Активирован!"      "❌ Уже активирован"  "❌ Ключ не найден"

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

                           РАБОТА С БОТОМ
                           
┌─────────────────────────────────────────────────────────────────────┐
│            ПОЛЬЗОВАТЕЛЬ ОТПРАВЛЯЕТ ТЕКСТ / ГОЛОС / ФОТО             │
└─────────────────────────────────────────────────────────────────────┘
                                 │
                    ┌────────────┴────────────┐
                    │                         │
            ┌───────▼────────┐      ┌────────▼────────┐
            │  Ключ ЕСТЬ     │      │  Ключа НЕТ     │
            └───────┬────────┘      └────────┬────────┘
                    │                         │
                    │                         ▼
                    │            "🔒 Активируйте ключ"
                    │                         │
                    │                         СТОП ⛔
                    │
        ┌───────────┴───────────────────┐
        │                               │
        ▼                               ▼
┌───────────────┐              ┌─────────────────┐
│  Текст/Голос  │              │      ФОТО       │
└───────┬───────┘              └────────┬────────┘
        │                               │
        ▼                               │
"📷 Отправьте фото"                    │
        │                               │
     СТОП ⛔                            │
                                        │
                            ┌───────────┴───────────┐
                            │                       │
                    ┌───────▼────────┐    ┌────────▼────────┐
                    │ Лимит исчерпан │    │ Лимит есть     │
                    └───────┬────────┘    └────────┬────────┘
                            │                       │
                            ▼                       ▼
              "❌ Лимит исчерпан"        📸 АНАЛИЗ ФОТО
                            │                       │
                         СТОП ⛔                    ▼
                                        ┌─────────────────┐
                                        │ OpenAI Vision   │
                                        └────────┬────────┘
                                                 │
                                                 ▼
                                        ┌─────────────────┐
                                        │ Калории + БЖУ   │
                                        └────────┬────────┘
                                                 │
                                                 ▼
                                        ┌─────────────────┐
                                        │ Сохранить в БД  │
                                        └────────┬────────┘
                                                 │
                                                 ▼
                                        ┌─────────────────┐
                                        │ Отправить ответ │
                                        └────────┬────────┘
                                                 │
                                                 ▼
                                        "🍽 Продукт: ..."
                                        "📊 Калории: ..."
                                        "📈 За сегодня: ..."
                                        "📊 Осталось: X" ⚠️

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

                          ПРОВЕРКА СТАТУСА

┌─────────────────────────────────────────────────────────────────────┐
│                      /key_info или /stats                           │
└─────────────────────────────────────────────────────────────────────┘
                                 │
                    ┌────────────┴────────────┐
                    │                         │
            ┌───────▼────────┐      ┌────────▼────────┐
            │  Ключ ЕСТЬ     │      │  Ключа НЕТ     │
            └───────┬────────┘      └────────┬────────┘
                    │                         │
                    │                         ▼
                    │            "❌ Активируйте ключ"
                    │
        ┌───────────┴───────────────────┐
        │                               │
        ▼                               ▼
┌───────────────┐              ┌─────────────────┐
│  Безлимитный  │              │  Ограниченный   │
└───────┬───────┘              └────────┬────────┘
        │                               │
        ▼                               ▼
"🔓 Безлимитный"                "🔐 Ограниченный"
"✅ Активен"                    "Использовано: 5"
"Фото: ♾️"                      "Осталось: 15"
                                        │
                            ┌───────────┴───────────┐
                            │                       │
                    ┌───────▼────────┐    ┌────────▼────────┐
                    │ Лимит > 5      │    │ Лимит ≤ 5      │
                    └────────────────┘    └────────┬────────┘
                                                   │
                                                   ▼
                                          "⚠️ Мало анализов!"

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

                      ЛЕГЕНДА СИМВОЛОВ

✅  - Успешно
❌  - Ошибка
⛔  - Остановка
⚠️  - Предупреждение
📷  - Фото
📊  - Статистика
🔒  - Требуется ключ
🔓  - Безлимитный доступ
🔐  - Ограниченный доступ
♾️  - Бесконечно

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

                        КЛЮЧЕВЫЕ ТОЧКИ

🔑  Проверка ключа происходит:
    • При /start
    • При отправке текста
    • При отправке голоса
    • При отправке фото
    • При /key_info, /stats

📊  Лимит проверяется:
    • Только при отправке фото
    • После каждого анализа обновляется

💾  В БД сохраняется:
    • Активация ключа
    • Каждое использование фото
    • Результаты анализа

╔══════════════════════════════════════════════════════════════════════╗
║                    Полная защита! 🔐                                 ║
╚══════════════════════════════════════════════════════════════════════╝
